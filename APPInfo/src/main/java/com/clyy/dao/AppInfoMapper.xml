<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.clyy.dao.AppInfoMapper">
    <select id="findAllAppInfo" resultType="appInfo">
        select * from app_info
    </select>
    <!--分页查询-->
    <select id="getAppInfoByPage" resultType="AppInfo">
        SELECT
            ai.id,
            ai.softwareName,
            ai.APKName,
            ai.softwareSize,
            ai.flatformId,
            ai.categoryLevel1,
            ai.categoryLevel2,
            ai.categoryLevel3,
            ai.status,
            ai.downloads,
            av.versionNo,
            dd.valueName statusName,
            ddy.valueName flatformName,
            ac1.categoryName categoryLevel1Name,
            ac2.categoryName categoryLevel2Name,
            ac3.categoryName categoryLevel3Name
        FROM app_info ai
        LEFT JOIN app_version av ON ai.id=av.appId
        JOIN data_dictionary dd ON ai.flatformId=dd.valueId AND dd.typeCode='APP_FLATFORM'
        JOIN data_dictionary ddy ON ai.status=ddy.valueId AND ddy.typeCode='APP_STATUS'
        JOIN app_category ac1 ON ai.categoryLevel1=ac1.id
        JOIN app_category ac2 ON ai.categoryLevel2=ac2.id
        JOIN app_category ac3 ON ai.categoryLevel3=ac3.id
	     <trim prefix="where" prefixOverrides="and|or">
             <if test="softwareName!=null and softwareName!=''">
                 and softwareName like concat('%',#{softwareName},'%')
             </if>
         </trim>
         GROUP BY app_info.id
         LIMIT #{pageIndex},#{pageSize}
    </select>

    <select id="getAppInfoCount" resultType="Integer">
        SELECT COUNT(1) FROM app_info
        <trim prefix="where" prefixOverrides="and|or">
            <if test="softwareName!=null and softwareName!=''">
                and softwareName like concat('%',#{softwareName},'%')
            </if>
        </trim>
    </select>

    <!--appInfo的映射文件-->
    <resultMap id="AppInfo" type="appInfo">
        <id column="id" property="id"></id>
        <result column="softwareName" property="softwareName"></result>
        <result column="softwareSize" property="softwareSize"></result>
        <result column="flatformId" property="flatformId"></result>
        <result column="categoryLevel1" property="categoryLevel1"></result>
        <result column="categoryLevel2" property="categoryLevel2"></result>
        <result column="categoryLevel3" property="categoryLevel3"></result>
        <result column="status" property="status"></result>
        <result column="downloads" property="downloads"></result>
        <result column="versionNo" property="versionNo"></result>
        <result column="statusName" property="statusName"></result>
        <result column="flatformName" property="flatformName"></result>
        <result column="categoryLevel1Name" property="categoryLevel1Name"></result>
        <result column="categoryLevel2Name" property="categoryLevel2Name"></result>
        <result column="categoryLevel3Name" property="categoryLevel3Name"></result>
    </resultMap>
</mapper>